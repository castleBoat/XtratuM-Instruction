# Build Patched Linux Kernel for XtratuM

### Build Kernel

This may be helpful

```
#backup
sudo cp /opt/linux-3.0.34-xm /opt/linux-3.0.34-xm.b
#obtain current running config
sudo cp /boot/config-3.x.x-amd64 /opt/linux-3.0.34-xm/
cd /opt/linux-3.0.34-xm/
sudo mv config-3.x.x-amd64 running.config
#or
zcat /proc/config.gz > running.config
```

### In addition

There are several lines that configure XtratuM in the original ```.config```
```config
CONFIG_XM_PARTITION=y
# CONFIG_XM_BOOTCONSOLE is not set
# CONFIG_XM_DEBUGCONSOLE is not set
CONFIG_XM_VIRTSRV=y
CONFIG_XM_SPARE_MANAGER=y
# CONFIG_XM_RESET is not set
CONFIG_XMIO_SERVER=y
CONFIG_XMIO_CLIENT=y
CONFIG_XMIO_SCAN_PERIOD=100
# CONFIG_XMIO_SSE2_MEMCPY is not set
```
Other lines that contains in ```.config``` but not in running.config could be generated by:
```sh
diff .config running.config > dif
perl undef.pl > undef.xm
```
[undef.pl](https://github.com/lushl9301/XtratuM-Instruction/blob/master/undef.pl) and [undef.xm] (https://github.com/lushl9301/XtratuM-Instruction/blob/master/undef.xm)(modified) are in this repo too.



```sh
emacs .config
#copy and paste into our running.config
sudo mv .config .config.b.xm
sudo cp running.config .config
```

```
sudo make
sudo make modules
sudo make modules_install
sudo make install
```

This makes the built patched kernel has almost the same configuration as your current running conditions. Your drivers, modules should be roughly the same.
